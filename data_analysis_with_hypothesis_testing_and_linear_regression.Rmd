---
title: "Exploring Life Expectancy: A Data Analysis Using Hypothesis Testing and Linear Regression"
author: "..., Alina Yildir, ..."
date: "2024-09-30"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r}
library(ggplot2)
library(ggtext)
library(dplyr)
library(tidyr)
library(reshape2)

# We will use the following color codes for our visualizations:

# "#2e6a57" => Life Expectancy (Target Variable)
# "#9b2542" => Health Risk Factors and Mortality Indicators
# "#6F4E37" => Vaccination and Disease Control Indicators
# "#2b457e" => Healthcare Expenditure and Resource Indicators
# "#d59d3f" => Socio-Economic and Educational Indicators
```

```{r}
dataset <- read.csv("life_expectancy_data_raw.csv")
head(dataset)
```

# Exploratory Data Analysis

## Univariate Analysis

```{r}
str(dataset)
```

The dataset contains 2,938 observations and 22 variables, capturing a range of demographic, health, and economic indicators for various countries.

```{r}
summary(dataset)
```

```{r}
colSums(is.na(dataset))
```

```{r}
num_duplicates <- nrow(dataset[duplicated(dataset), ])
num_duplicates
```

The dataset has no duplicate rows (i.e., every row is unique based on the combination of all columns).

We will briefly overview each column, highlighting its potential influence on life expectancy, the target variable.

The `Country` variable contains 2,938 entries representing different countries over various years, with each country listed multiple times based on the year. The dataset includes 193 distinct countries; this variable has no missing values. The `Country` variable allows for **analyzing variations in life expectancy among nations**.

```{r}
num_unique_countries <- length(unique(dataset$Country))
num_unique_countries
```

The `Year` variable ranges from 2000 to 2015, covering 15 years. There are no missing values in this variable. The `Year` variable allows for **examining how life expectancy has changed over time**.

The `Life.expectancy` variable, **the target variable in this analysis**, ranges from 36.3 to 89 years, with a mean of 69.22 and a median of 72.1. Since the median is higher than the mean, this suggests a slight left skew in the distribution, meaning some younger ages are pulling the mean down. There are 10 missing values in this variable.

```{r}
life_expectancy_cleaned <- dataset %>%
  filter(!is.na(Life.expectancy))

ggplot(life_expectancy_cleaned, aes(x = "", y = Life.expectancy)) +
  geom_boxplot(fill = "#2e6a57", color = "black") +
  labs(title = "Distribution of Life Expectancy",
       x = "", y = "Life Expectancy (Years)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title.x = element_blank(),
    axis.title.y = element_text(size = 12)
  )
```

We have grouped the rest of the dataset variables into four categories:

* Health Risk Factors and Mortality Indicators
* Vaccination and Disease Control Indicators
* Healthcare Expenditure and Resource Indicators
* Socio-Economic and Educational Indicators

### Health Risk Factors and Mortality Indicators

The `Adult.Mortality` variable represents the number of deaths of individuals between 15 and 60 years old per 1,000 population. The values range from 1 to 723 deaths per 1,000 adults, with a mean of 164.8 and a median of 144. This suggests that the distribution is skewed to the right, indicating the presence of outliers at the higher end of the scale. There are 10 missing values in this variable. The `Adult.Mortality` variable allows for **assessing the impact of adult mortality on life expectancy**.

```{r}
adult_mortality_cleaned <- dataset %>%
  filter(!is.na(Adult.Mortality))

ggplot(adult_mortality_cleaned, aes(x = "", y = Adult.Mortality)) +
  geom_boxplot(fill = "#9b2542", color = "black") +
  labs(title = "Distribution of Adult Mortality",
       x = "", y = "Deaths per 1,000 Adults") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title.y = element_text(size = 12)
  )
```

The `under.five.deaths` variable measures the number of deaths of children under five per 1,000 population. The mean value is 42.04, with a median of 4. The much higher mean compared to the median indicates a positively skewed (right-skewed) distribution. This means most regions have low child mortality rates, but a few have much higher rates. There are no missing values in this variable. The `under.five.deaths` variable allows for **analyzing the relationship between child mortality and life expectancy**.

The `infant.deaths` variable represents the number of infant deaths per 1,000 population, with a mean of 23.94 and a median of 3. This significant difference between the mean and median suggests a highly right-skewed distribution, indicating the presence of outliers at the higher end of the scale. There are no missing values in this variable. The `infant.deaths` variable allows for **assessing the impact of infant mortality on life expectancy**.

```{r}
infant_deaths_cleaned <- dataset %>%
  filter(!is.na(infant.deaths),
         infant.deaths <= 1000)

mean(infant_deaths_cleaned$infant.deaths)
median(infant_deaths_cleaned$infant.deaths)
```

```{r}
ggplot(infant_deaths_cleaned, aes(x = "", y = infant.deaths)) +
  geom_boxplot(fill = "#9b2542", color = "black") +
  labs(title = "Distribution of Infant Mortality",
       x = "", y = "Deaths per 1,000 Infants") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title.y = element_text(size = 12)
  )
```

The `BMI` variable represents the entire population's average Body Mass Index (BMI). The mean BMI is 38.32, with a median of 43.5. The median being higher than the mean suggests a left-skewed distribution. This indicates that while many individuals have higher BMI values, there are some with significantly lower BMI values, which pull the mean down. There are 34 missing values in this variable. The `BMI` variable allows for **exploring how BMI levels in a population correlate with life expectancy**.

```{r}
bmi_cleaned <- dataset %>%
  filter(!is.na(BMI))

ggplot(bmi_cleaned, aes(x = "", y = BMI)) +
  geom_boxplot(fill = "#9b2542", color = "black") +
  labs(title = "Distribution of Body Mass Index (BMI)",
       x = "", y = "BMI") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title.y = element_text(size = 12)
  )
```

The `HIV.AIDS` variable represents deaths per 1,000 live births among children aged 0-4 due to HIV/AIDS. The minimum value is 0.1, with the first quartile at 0.1, the median also at 0.1, and the third quartile at 0.8. There are no missing values in this variable. The `HIV.AIDS` variable allows for **assessing how the HIV/AIDS epidemic affects child survival rates and, consequently, contributes to overall life expectancy**.

The `thinness..1.19.years` variable captures the prevalence of thinness (underweight) among children and adolescents aged 10 to 19, expressed as a percentage. The mean value is 4.84%, with a median of 3.3%. The higher mean compared to the median suggests the presence of outliers with high prevalence rates of thinness. These outliers significantly affect the overall average. There are 34 missing values in this variable. The `thinness..1.19.years` variable allows for **assessing the effect of malnutrition on life expectancy**.

```{r}
thinness_10_19_years_cleaned <- dataset %>%
  filter(!is.na(thinness..1.19.years))

ggplot(thinness_10_19_years_cleaned, aes(x = "", y = thinness..1.19.years)) +
  geom_boxplot(fill = "#9b2542", color = "black") +
  labs(title = "Distribution of Thinness<br>
       Among Children and Adolescents (10-19 Years)",
       x = "", y = "Prevalence of Thinness (%)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                              lineheight = 1.2),
    axis.title.y = element_text(size = 12)
  ) +
  theme(plot.title = element_markdown())
```

The `thinness.5.9.years` variable measures the prevalence of thinness (underweight) among children aged 5 to 9, expressed as a percentage. The mean value is 4.87%, with a median of 3.3%. The difference between the mean and median suggests variability in the data. The presence of regions with higher prevalence rates contributes to this spread. There are 34 missing values in this variable. The `thinness.5.9.years` variable allows for **evaluating the relationship between childhood malnutrition and life expectancy**.

```{r}
thinness_5_9_years_cleaned <- dataset %>%
  filter(!is.na(thinness.5.9.years))

ggplot(thinness_5_9_years_cleaned, aes(x = "", y = thinness.5.9.years)) +
  geom_boxplot(fill = "#9b2542", color = "black") +
  labs(title = "Distribution of Thinness<br>
       Among Children (5-9 Years)",
       x = "", y = "Prevalence of Thinness (%)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                              lineheight = 1.2),
    axis.title.y = element_text(size = 12)
  ) +
  theme(plot.title = element_markdown())
```

The `Alcohol` variable represents the recorded per capita (age 15+) consumption of pure alcohol in liters, with a mean alcohol consumption of 4.6 liters and a median of 3.76 liters. The mean is higher than the median, suggesting a right-skewed distribution, where a few countries have significantly higher alcohol consumption, pulling the mean upwards. There are 194 missing values in this variable. The `Alcohol` variable allows for **examining the influence of alcohol consumption on life expectancy**.

```{r}
alcohol_cleaned <- dataset %>%
  filter(!is.na(Alcohol))

ggplot(alcohol_cleaned, aes(x = "", y = Alcohol)) +
  geom_boxplot(fill = "#9b2542", color = "black") +
  labs(title = "Distribution of Alcohol Consumption",
    x = "", y = "Alcohol Consumption (Liters per Capita)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title.y = element_text(size = 12)
  )
```

### Vaccination and Disease Control Indicators

The `Hepatitis.B` variable shows the immunization coverage rate among 1-year-olds for Hepatitis B, expressed as a percentage. The mean coverage is 80.94%, with a median of 92%. The median is higher than the mean, indicating a left-skewed distribution. This suggests that while many countries have high immunization rates, there are some with significantly lower rates, which pull the mean down. There are 553 missing values in this variable. The `Hepatitis.B` variable allows for **analyzing the impact of Hepatitis B immunization on life expectancy**.

```{r}
hepatitis_b_cleaned <- dataset %>%
  filter(!is.na(Hepatitis.B))

ggplot(hepatitis_b_cleaned, aes(x = "", y = Hepatitis.B)) +
  geom_boxplot(fill = "#6F4E37", color = "black") +
  labs(title = "Distribution of Hepatitis B Immunization Coverage (IC)",
       x = "", y = "Hepatitis B IC (% of 1-Year-Olds)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title.y = element_text(size = 12)
  )
```

The `Polio` variable represents the immunization coverage rate for the Polio (Pol3) vaccine among 1-year-olds as a percentage. The mean coverage is 82.55%, with a median of 93%. The lower mean compared to the median suggests the presence of outliers with low immunization coverage rates. These outliers significantly affect the overall average. There are 19 missing values in this variable. The `Polio` variable allows for **exploring how Polio immunization rates impact life expectancy**.

```{r}
polio_cleaned <- dataset %>%
  filter(!is.na(Polio))

ggplot(polio_cleaned, aes(x = "", y = Polio)) +
  geom_boxplot(fill = "#6F4E37", color = "black") +
  labs(title = "Distribution of Polio Immunization Coverage (IC)",
       x = "", y = "Polio IC (% of 1-Year-Olds)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title.y = element_text(size = 12)
  )
```

The `Diphtheria` variable shows the immunization coverage rate for Diphtheria, Tetanus, and Pertussis (DTP3) among 1-year-olds, as a percentage. The mean coverage is 82.32%, with a median of 93%. The higher median compared to the mean indicates a negatively skewed distribution. This means most countries have high immunization rates, but a few have much lower rates. There are 19 missing values in this variable. The `Diphtheria` variable allows for **analyzing the impact of DTP3 immunization on life expectancy**.

```{r}
diphtheria_cleaned <- dataset %>%
  filter(!is.na(Diphtheria))

ggplot(diphtheria_cleaned, aes(x = "", y = Diphtheria)) +
  geom_boxplot(fill = "#6F4E37", color = "black") +
  labs(title = "Distribution of DTP3 Immunization Coverage (IC)",
       x = "", y = "DTP3 IC (% of 1-Year-Olds)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title.y = element_text(size = 12)
  )
```

The `Measles` variable represents the number of reported measles cases per 1,000 population. The minimum number of cases reported is 0, with the first quartile (25th percentile) showing 0 cases, the median (50th percentile) reporting 17 cases, and the third quartile (75th percentile) showing 360.2 cases. There are no missing values in this variable. The `Measles` variable allows for **evaluating the impact of infectious disease outbreaks on life expectancy**.

### Healthcare Expenditure and Resource Indicators

The `Total.expenditure` variable represents the percentage of government expenditure allocated to healthcare. The mean value is 5.94%, with a median of 5.76%. The mean and median are pretty close, suggesting a relatively symmetrical distribution. This indicates that the percentage of government expenditure allocated to healthcare is relatively consistent across different countries. There are 226 missing values in this variable. The `Total.expenditure` variable allows for **examining the role of government health spending in influencing life expectancy**.

```{r}
total_expenditure_cleaned <- dataset %>%
  filter(!is.na(Total.expenditure))

ggplot(total_expenditure_cleaned, aes(x = "", y = Total.expenditure)) +
  geom_boxplot(fill = "#2b457e", color = "black") +
  labs(title = "Distribution of Total Health Expenditure",
       x = "", y = "Total Health Expenditure (%)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title.y = element_text(size = 12)
  )
```

The `percentage.expenditure` variable reflects the expenditure on health as a percentage of Gross Domestic Product (GDP) per capita, with a mean value of 738.25% and a median of 64.91%. The extremely high mean compared to the median indicates the presence of outliers. These outliers are countries with exceptionally high health expenditures as a percentage of GDP per capita. There are no missing values in this variable. The `percentage.expenditure` variable allows for **understanding the relationship between health expenditure and life expectancy**.

```{r}
percentage_expenditure_cleaned <- dataset %>%
  filter(!is.na(percentage.expenditure))

ggplot(percentage_expenditure_cleaned,
       aes(x = "", y = percentage.expenditure)) +
  geom_boxplot(fill = "#2b457e", color = "black") +
  labs(title = "Distribution of Health Expenditure",
       x = "", y = "Health Expenditure (% of GDP)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                              lineheight = 1.2),
    axis.title.y = element_text(size = 12)
  )
```

### Socio-Economic and Educational Indicators

The `Income.composition.of.resources` variable represents the Human Development Index (HDI) in terms of income composition, with values ranging from 0 to 1. The mean value is 0.6276, and the median value is 0.677. The lower mean compared to the median suggests the presence of outliers with low HDI values. There are 167 missing values in this variable. The `Income.composition.of.resources` variable allows for **analyzing the relationship between HDI and life expectancy**.

```{r}
income_composition_of_resources_cleaned <- dataset %>%
  filter(!is.na(Income.composition.of.resources))

ggplot(income_composition_of_resources_cleaned,
       aes(x = "", y = Income.composition.of.resources)) +
  geom_boxplot(fill = "#d59d3f", color = "black") +
  labs(title = "Distribution of Human Development Index (HDI)",
       x = "", y = "HDI") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title.y = element_text(size = 12)
  )
```

The `GDP` variable represents Gross Domestic Product per capita in USD. The average GDP per capita is \$7,483.16, with a median of \$1,766.95. The mean being significantly higher than the median suggests a right-skewed distribution. This indicates that while many countries have lower GDP per capita, a few countries with very high GDP per capita pull the mean upwards. There are 448 missing values in this variable. The `GDP` variable allows for **examining the relationship between economic prosperity and life expectancy**.

```{r}
gdp_cleaned <- dataset %>%
  filter(!is.na(GDP))

ggplot(gdp_cleaned, aes(x = "", y = GDP)) +
  geom_boxplot(fill = "#d59d3f", color = "black") +
  labs(title = "Distribution of GDP per Capita",
       x = "", y = "GDP per Capita (USD)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title.y = element_text(size = 12)
  )
```

The `Schooling` variable measures the average years of schooling in a country. The mean value is 11.99 years, and the median is 12.3 years. The close values of the mean and median suggest that the data is relatively concentrated around the central values, with moderate variability. There are 163 missing values in this variable. This variable allows for **exploring the impact of education on life expectancy**.

```{r}
schooling_cleaned <- dataset %>%
  filter(!is.na(Schooling))

ggplot(schooling_cleaned, aes(x = "", y = Schooling)) +
  geom_boxplot(fill = "#d59d3f", color = "black") +
  labs(title = "Distribution of Years of Schooling",
       x = "", y = "Schooling (Years)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title.y = element_text(size = 12)
  )
```

The `Population` variable represents the total population of each country. The mean population is approximately 12.75 million, with a median of around 1.39 million. The much higher mean compared to the median indicates a positively skewed (right-skewed) distribution. This means most regions or countries have smaller populations, but a few have much larger populations. There are 652 missing values in this variable. The `Population` variable allows for **exploring how population size might relate to life expectancy**.

The `Status` variable categorizes countries as "Developed" or "Developing." The dataset has 32 developed, and 161 developing countries and no missing values are in this variable. The `Status` variable allows for **comparing life expectancy between developed and developing countries**.

```{r}
num_developed_countries <- length(unique(dataset$Country[dataset$Status ==
                                                           "Developed"]))
num_developed_countries
num_developing_countries <- length(unique(dataset$Country[dataset$Status ==
                                                            "Developing"]))
num_developing_countries
```

## Multivariate Analysis

```{r}
average_life_exp <- dataset %>%
  select(Country, Life.expectancy) %>%
  filter(!is.na(Life.expectancy)) %>%
  group_by(Country) %>%
  summarise(avg_life_exp = mean(Life.expectancy))
head(average_life_exp)
```
```{r}
mean(as.numeric(average_life_exp$avg_life_exp), na.rm = TRUE)
median(as.numeric(average_life_exp$avg_life_exp), na.rm = TRUE)
```

Since the mean is less than the median, the distribution is likely left-skewed. This suggests that some lower life expectancy values are pulling the mean down. The left skewness implies the presence of outliers or a longer tail on the lower end of the life expectancy spectrum. These could be countries with significantly lower life expectancies due to various factors such as health crises, conflicts, or economic challenges.

```{r}
ggplot(average_life_exp, aes(x = "", y = avg_life_exp)) +
  geom_boxplot(fill = "#2e6a57", color = "black") +
  labs(title = "Distribution of Global Average Life Expectancy<br>
       (2000-2015)", x = "", y = "Average Life Expectancy (Years)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                              lineheight = 1.2),
    axis.title.x = element_blank(),
    axis.title.y = element_text(size = 12)
  ) +
  theme(plot.title = element_markdown())
```

The top 15 countries with the highest average life expectancy are Japan, Sweden, Iceland, Switzerland, France, Italy, Spain, Australia, Norway, Canada, Austria, Singapore, New Zealand, Israel, and Greece.

```{r}
average_life_exp_desc <- dataset %>%
  select(Country, Life.expectancy) %>%
  filter(!is.na(Life.expectancy)) %>%
  group_by(Country) %>%
  summarise(average_life_expectancy = mean(Life.expectancy)) %>%
  arrange(desc(average_life_expectancy)) %>%
  slice(1:15)
head(average_life_exp_desc)
```

```{r}
ggplot(average_life_exp_desc,
       aes(x = reorder(Country, average_life_expectancy),
           y = average_life_expectancy)) +
  geom_bar(stat = "identity", fill = "#2e6a57") +
  coord_flip() +
  labs(title = "Top 15 Countries<br>
       with the Highest Average Life Expectancy<br>
       (2000-2015)", x = "Country", y = "Average Life Expectancy (Years)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                              lineheight = 1.2),
    axis.title.x = element_text(size = 12),
    axis.title.y = element_text(size = 12)
  ) +
  theme(plot.title = element_markdown())
```

The top 15 countries with the lowest average life expectancy are Cameroon, Zambia, South Sudan, Mozambique, Somalia, Nigeria, Swaziland, Zimbabwe, Côte d’Ivoire, Chad, Malawi, Angola, Lesotho, Central African Republic, and Sierra Leone.

```{r}
average_life_exp_asc <- dataset %>%
  select(Country, Life.expectancy) %>%
  filter(!is.na(Life.expectancy)) %>%
  group_by(Country) %>%
  summarise(average_life_expectancy = mean(Life.expectancy)) %>%
  arrange(average_life_expectancy) %>%
  slice(1:15)
head(average_life_exp_asc)
```

```{r}
ggplot(average_life_exp_asc,
       aes(x = reorder(Country, average_life_expectancy),
           y = average_life_expectancy)) +
  geom_bar(stat = "identity", fill = "#9b2542") +
  coord_flip() +
  labs(title = "Top 15 Countries<br>
       with the Lowest Average Life Expectancy<br>
       (2000-2015)", x = "Country", y = "Average Life Expectancy (Years)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                              lineheight = 1.2),
    axis.title.x = element_text(size = 12),
    axis.title.y = element_text(size = 12)
  ) +
  theme(plot.title = element_markdown())
```

There has been a slight increase in life expectancy for both developed and developing countries in general.

```{r}
life_expectancy_over_time_by_country_type <- dataset %>%
  select(Life.expectancy, Country, Year, Status) %>%
  filter(!is.na(Life.expectancy)) %>%
  filter(Status %in% c("Developed", "Developing"))

ggplot(life_expectancy_over_time_by_country_type,
       aes(x = Year, y = Life.expectancy, group = Country)) +
  geom_line(color = "grey", size = 1) +
  geom_smooth(aes(group = 1), method = "loess", se = FALSE,
              color = "#2e6a57", linewidth = 1.2) +
  labs(title = "Trends in Life Expectancy by Country Type (2000-2015)",
       x = "Year", y = "Life Expectancy (Years)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title.x = element_text(size = 12),
    axis.title.y = element_text(size = 12),
    strip.text = element_text(size = 12),
    legend.position = "none"
  ) +
  facet_wrap(~ Status)
```

```{r}
life_exp_comp_dev_dev <- dataset %>%
  select(Life.expectancy, Status) %>%
  filter(!is.na(Life.expectancy))

ggplot(life_exp_comp_dev_dev,
       aes(x = Status, y = Life.expectancy, fill = Status)) +
  geom_boxplot() +
  scale_fill_manual(values = c("Developed" = "#2e6a57",
                               "Developing" = "#9b2542")) +
  labs(title = "Distribution of Life Expectancy by Country Type",
       x = "Country Type", y = "Life Expectancy") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                              lineheight = 1.2),
    axis.title.x = element_text(size = 12),
    axis.title.y = element_text(size = 12),
    legend.position = "none"
  )
```

The boxplot compares the life expectancy between **developed** and **developing** countries. The median life expectancy for developed countries is higher than for developing countries, as indicated by the higher median line within the box. The interquartile range (IQR) for developed countries is narrower, suggesting less variability in life expectancy compared to developing countries. The whiskers extend further for developing countries, indicating a wider range of life expectancy values. Additionally, there are more outliers in the developing countries' data, suggesting the presence of extreme values.

### Health Risk Factors and Mortality Indicators

To visualize the impact of the **Health Risk Factors and Mortality Indicators** on life expectancy,

```{r}
health_risk_factors_mortality_indicators_part_1 <- dataset %>%
  select(Life.expectancy, Adult.Mortality, under.five.deaths,
         infant.deaths, HIV.AIDS)
head(health_risk_factors_mortality_indicators_part_1)
```

```{r}
health_risk_factors_mortality_indicators_part_1_long_format <-
  health_risk_factors_mortality_indicators_part_1 %>%
  pivot_longer(cols = -Life.expectancy,
               names_to = "health_risk_factors_1",
               values_to = "values") %>%
  filter(!(health_risk_factors_1 == "infant.deaths"
           & values > 1000),
         !(health_risk_factors_1 == "under.five.deaths"
           & values > 1000),
         !(health_risk_factors_1 == "HIV.AIDS"
           & values > 1000),
         !is.na(Life.expectancy),
         !(health_risk_factors_1 == "Adult.Mortality"
           & is.na(values)),
         !(health_risk_factors_1 == "under.five.deaths"
           & is.na(values)),
         !(health_risk_factors_1 == "infant.deaths"
           & is.na(values)),
         !(health_risk_factors_1 == "HIV.AIDS"
           & is.na(values)))
head(health_risk_factors_mortality_indicators_part_1_long_format)
```

```{r}
custom_labels_1 <- c(
  "Adult.Mortality" = "Deaths per 1,000 Adults (Ages 15-60)",
  "infant.deaths" = "Deaths per 1,000 Infants",
  "under.five.deaths" = "Deaths per 1,000 Children Under 5",
  "HIV.AIDS" = "Deaths per 1,000 Children (0-4) from HIV/AIDS"
)

ggplot(health_risk_factors_mortality_indicators_part_1_long_format,
       aes(x = values, y = Life.expectancy)) +
  geom_point(alpha = 0.5, color = "#2e6a57") +
  geom_smooth(method = "lm", se = FALSE, color = "#9b2542") +
  facet_wrap(~ health_risk_factors_1, scales = "free_x",
             labeller = labeller(health_risk_factors_1 = custom_labels_1)) +
  labs(title = "Impact of Health Risk Factors and Mortality Indicators<br>
       on Life Expectancy (Part 1)", x = "", y = "Life Expectancy (Years)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                              lineheight = 1.2),
    axis.title.y = element_text(size = 12)
  ) +
  theme(plot.title = element_markdown())
```

```{r}
health_risk_factors_mortality_indicators_part_2 <- dataset %>%
  select(Life.expectancy, BMI, Alcohol,
         thinness..1.19.years, thinness.5.9.years)
head(health_risk_factors_mortality_indicators_part_2)
```

```{r}
health_risk_factors_mortality_indicators_part_2_long_format <-
  health_risk_factors_mortality_indicators_part_2 %>%
  pivot_longer(cols = -Life.expectancy,
               names_to = "health_risk_factors_2",
               values_to = "values") %>%
  filter(!is.na(Life.expectancy),
         !(health_risk_factors_2 == "BMI"
           & is.na(values)),
         !(health_risk_factors_2 == "thinness..1.19.years"
           & is.na(values)),
         !(health_risk_factors_2 == "thinness.5.9.years"
           & is.na(values)),
         !(health_risk_factors_2 == "Alcohol"
           & is.na(values)))
head(health_risk_factors_mortality_indicators_part_2_long_format)
```

```{r}
custom_labels_2 <- c(
  "BMI" = "Body Mass Index (BMI)",
  "thinness..1.19.years" = "Thinness (Ages 1-19)",
  "thinness.5.9.years" = "Thinness (Ages 5-9)",
  "Alcohol" = "Alcohol Consumption"
)

ggplot(health_risk_factors_mortality_indicators_part_2_long_format,
       aes(x = values, y = Life.expectancy)) +
  geom_point(alpha = 0.5, color = "#2e6a57") +
  geom_smooth(method = "lm", se = FALSE, color = "#9b2542") +
  facet_wrap(~ health_risk_factors_2, scales = "free_x",
             labeller = labeller(health_risk_factors_2 = custom_labels_2)) +
  labs(title = "Impact of Health Risk Factors and Mortality Indicators<br>
       on Life Expectancy (Part 2)", x = "", y = "Life Expectancy (Years)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                              lineheight = 1.2),
    axis.title.y = element_text(size = 12)
  ) +
  theme(plot.title = element_markdown())
```

```{r}
health_risk_factors_mortality_ind <- dataset %>%
  select(
    `Life Expectancy` = Life.expectancy,
    `Adult Mortality` = Adult.Mortality,
    `Infant Mortality` = infant.deaths,
    `Child Mort (U5)` = under.five.deaths,
    `HIV/AIDS Child Mort (U4)` = HIV.AIDS,
    `BMI` = BMI,
    `Thinness (10-19)` = thinness..1.19.years,
    `Thinness (5-9)` = thinness.5.9.years,
    `Alcohol Consumption` = Alcohol
  ) %>%
  filter(`Infant Mortality` <= 1000,
         `Child Mort (U5)` <= 1000,
         `HIV/AIDS Child Mort (U4)` <= 1000)
health_risk_factors_mortality_ind_cor <-
  cor(health_risk_factors_mortality_ind, use = "complete.obs")
health_risk_factors_mortality_ind_cor_long_format <-
  melt(health_risk_factors_mortality_ind_cor)
head(health_risk_factors_mortality_ind_cor_long_format)
```

```{r}
ggplot(health_risk_factors_mortality_ind_cor_long_format,
       aes(Var1, Var2, fill = value)) +
  geom_tile(color = "white", size = 0.5) +
  geom_text(aes(label = round(value, 2)), color = "black", size = 2.5) +
  scale_fill_gradient2(low = "#2b457e", high = "#9b2542", mid = "white",
                       midpoint = 0, limit = c(-1, 1), space = "Lab",
                       name = "Correlation Coefficient") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                              lineheight = 1.2),
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
    axis.title.x = element_blank(),
    axis.title.y = element_blank()
    ) +
  coord_fixed() +
  labs(title = "Correlation Analysis of<br>
       Health Risk Factors and Mortality Indicators") +
  theme(plot.title = element_markdown())
```

The correlation between **Adult Mortality** and **Life Expectancy** is **-0.69**. This indicates a strong negative relationship, meaning higher adult mortality is associated with lower life expectancy.

The correlation between **Infant Mortality** and **Life Expectancy** is **-0.33**. This shows a moderate negative relationship, suggesting that higher infant mortality is associated with lower life expectancy.

The correlation between **Child Mortality (Under 5)** and **Life Expectancy** is **-0.36**. This indicates a moderate negative relationship, meaning higher child mortality is associated with lower life expectancy.

The correlation between **HIV/AIDS Child Mortality (Under 4)** and **Life Expectancy** is **-0.57**. This shows a strong negative relationship, suggesting that higher HIV/AIDS child mortality is associated with lower life expectancy.

The correlation between **BMI** and **Life Expectancy** is **0.57**. This indicates a strong positive relationship, meaning higher BMI is associated with higher life expectancy.

The correlation between **Thinness (Ages 1-19)** and **Life Expectancy** is **-0.5**. This shows a strong negative relationship, suggesting that higher thinness in the 10-19 age group is associated with lower life expectancy.

The correlation between **Thinness (Ages 5-9)** and **Life Expectancy** is **-0.5**. This indicates a strong negative relationship, meaning higher thinness in the 5-9 age group is associated with lower life expectancy.

The correlation between **Alcohol Consumption** and **Life Expectancy** is **0.4**. This shows a moderate positive relationship, suggesting that higher alcohol consumption is associated with higher life expectancy.

In summary, variables like adult mortality, infant mortality, child mortality, HIV/AIDS child mortality, and thinness have negative correlations with life expectancy, indicating that higher values in these variables are associated with lower life expectancy. On the other hand, BMI and alcohol consumption have positive correlations with life expectancy, suggesting that higher values in these variables are associated with higher life expectancy (just because two variables are correlated doesn't mean that one causes the other, correlation simply indicates that there is a relationship or pattern between the two variables).

### Vaccination and Disease Control Indicators

To visualize the impact of the **Vaccination and Disease Control Indicators** on life expectancy,

```{r}
vaccination_disease_control_indicators <- dataset %>%
  select(Life.expectancy, Hepatitis.B, Polio,
         Diphtheria, Measles)
head(vaccination_disease_control_indicators)
```

```{r}
vaccination_disease_control_indicators_long_format <-
  vaccination_disease_control_indicators %>%
  pivot_longer(cols = -Life.expectancy,
               names_to = "vaccination_disease_indicators",
               values_to = "values") %>%
  filter(!(vaccination_disease_indicators == "Measles"
           & values > 1000),
         !is.na(Life.expectancy),
         !(vaccination_disease_indicators == "Hepatitis.B"
           & is.na(values)),
         !(vaccination_disease_indicators == "Polio"
           & is.na(values)),
         !(vaccination_disease_indicators == "Diphtheria"
           & is.na(values)),
         !(vaccination_disease_indicators == "Measles"
           & is.na(values)))
head(vaccination_disease_control_indicators_long_format)
```

```{r}
custom_labels_3 <- c(
  "Hepatitis.B" = "Hepatitis B Immunization Coverage (% of 1-Year-Olds)",
  "Polio" = "Polio Immunization Coverage (% of 1-Year-Olds)",
  "Diphtheria" = "DTP3 Immunization Coverage (% of 1-Year-Olds)",
  "Measles" = "Measles Cases per 1,000 Population"
)

ggplot(vaccination_disease_control_indicators_long_format,
       aes(x = values, y = Life.expectancy)) +
  geom_point(alpha = 0.5, color = "#2e6a57") +
  geom_smooth(method = "lm", se = FALSE, color = "#9b2542") +
  facet_wrap(~ vaccination_disease_indicators, scales = "free_x",
             labeller = labeller(vaccination_disease_indicators =
                                   custom_labels_3)) +
  labs(title = "Impact of Vaccination and Disease Control Indicators<br>
       on Life Expectancy", x = "", y = "Life Expectancy (Years)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                              lineheight = 1.2),
    axis.title.y = element_text(size = 12)
  ) +
  theme(plot.title = element_markdown())
```

```{r}
vaccination_disease_control_ind <- dataset %>%
  select(
    `Life Expectancy` = Life.expectancy,
    `Hepatitis B IC` = Hepatitis.B,
    `Polio IC` = Polio,
    `DTP3 IC` = Diphtheria,
    `Measles Cases` = Measles
  ) %>%
  filter(`Measles Cases` <= 1000)
vaccination_disease_control_ind_cor <-
  cor(vaccination_disease_control_ind, use = "complete.obs")
vaccination_disease_control_ind_cor_long_format <-
  melt(vaccination_disease_control_ind_cor)
head(vaccination_disease_control_ind_cor_long_format)
```

```{r}
ggplot(vaccination_disease_control_ind_cor_long_format,
       aes(Var1, Var2, fill = value)) +
  geom_tile(color = "white", size = 0.5) +
  geom_text(aes(label = round(value, 2)), color = "black", size = 3) +
  scale_fill_gradient2(low = "#2b457e", high = "#9b2542", mid = "white",
                       midpoint = 0, limit = c(-1, 1), space = "Lab",
                       name = "Correlation Coefficient") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                                  lineheight = 1.2),
        axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank()
        ) +
  coord_fixed() +
  labs(title = "Correlation Analysis of<br>
       Vaccination and Disease Control Indicators") +
  theme(plot.title = element_markdown())
```

The correlation between **Hepatitis B Immunization Coverage (IC)** and **Life Expectancy** is **0.2**. This indicates a weak positive relationship, suggesting that higher Hepatitis B immunization coverage is slightly associated with higher life expectancy.

The correlation between **Polio IC** and **Life Expectancy** is **0.31**. This shows a moderate positive relationship, meaning higher Polio immunization coverage is associated with higher life expectancy.

The correlation between **DTP3 IC** and **Life Expectancy** is **0.31**. This indicates a moderate positive relationship, suggesting that higher DTP3 (Diphtheria, Tetanus, and Pertussis) immunization coverage is associated with higher life expectancy.

The correlation between **Measles Cases** and **Life Expectancy** is **-0.19**. This shows a weak negative relationship, meaning higher numbers of measles cases are slightly associated with lower life expectancy.

In summary, immunization coverage for Hepatitis B, Polio, and DTP3 shows positive correlations with life expectancy, indicating that higher immunization rates are associated with higher life expectancy. The number of measles cases has a negative correlation with life expectancy, suggesting that more measles cases are associated with lower life expectancy.

### Healthcare Expenditure and Resource Indicators

To visualize the impact of the **Healthcare Expenditure and Resource Indicators** on life expectancy,

```{r}
healthcare_expenditure_resource_indicators <- dataset %>%
  select(Life.expectancy, Total.expenditure, percentage.expenditure)
head(healthcare_expenditure_resource_indicators)
```

```{r}
healthcare_expenditure_resource_indicators_long_format <-
  healthcare_expenditure_resource_indicators %>%
  pivot_longer(cols = -Life.expectancy,
               names_to = "healthcare_expenditure_indicators",
               values_to = "values") %>%
  filter(!is.na(Life.expectancy),
         !(healthcare_expenditure_indicators == "Total.expenditure"
           & is.na(values)),
         !(healthcare_expenditure_indicators == "percentage.expenditure"
           & is.na(values)))
head(healthcare_expenditure_resource_indicators_long_format)
```

```{r}
custom_labels_4 <- c(
  "Total.expenditure" = "Total Health Expenditure (%)",
  "percentage.expenditure" = "Health Expenditure (% of GDP)"
)

ggplot(healthcare_expenditure_resource_indicators_long_format,
       aes(x = values, y = Life.expectancy)) +
  geom_point(alpha = 0.5, color = "#2e6a57") +
  geom_smooth(method = "lm", se = FALSE, color = "#9b2542") +
  facet_wrap(~ healthcare_expenditure_indicators, scales = "free_x",
             labeller = labeller(healthcare_expenditure_indicators =
                                   custom_labels_4)) +
  labs(title = "Impact of Healthcare Expenditure and Resource Indicators<br>
       on Life Expectancy", x = "", y = "Life Expectancy (Years)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                              lineheight = 1.2),
    axis.title.y = element_text(size = 12)
  ) +
  theme(plot.title = element_markdown())
```

```{r}
healthcare_expenditure_resource_ind <- dataset %>%
  select(
    `Life Expectancy` = Life.expectancy,
    `THE (%)` = Total.expenditure,
    `HE (% of GDP)` = percentage.expenditure
  )
healthcare_expenditure_resource_ind_cor <-
  cor(healthcare_expenditure_resource_ind, use = "complete.obs")
healthcare_expenditure_resource_ind_cor_long_format <-
  melt(healthcare_expenditure_resource_ind_cor)
head(healthcare_expenditure_resource_ind_cor_long_format)
```

```{r}
ggplot(healthcare_expenditure_resource_ind_cor_long_format,
       aes(Var1, Var2, fill = value)) +
  geom_tile(color = "white", size = 0.5) +
  geom_text(aes(label = round(value, 2)), color = "black", size = 3.5) +
  scale_fill_gradient2(low = "#2b457e", high = "#9b2542", mid = "white",
                       midpoint = 0, limit = c(-1, 1), space = "Lab",
                       name = "Correlation Coefficient") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                                  lineheight = 1.2),
        axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank()) +
  coord_fixed() +
  labs(title = "Correlation Analysis of<br>
       Healthcare Expenditure and Resource Indicators") +
  theme(plot.title = element_markdown())
```

The correlation between **Total Health Expenditure (%)** and **Life Expectancy** is **0.22**. This indicates a weak positive relationship, suggesting that higher total health expenditure as a percentage of total expenditure is slightly associated with higher life expectancy.

The correlation between **Health Expenditure (% of GDP)** and **Life Expectancy** is **0.4**. This shows a moderate positive relationship, meaning that higher health expenditure as a percentage of GDP is associated with higher life expectancy.

In summary, both total health expenditure and health expenditure as a percentage of GDP have positive correlations with life expectancy. This suggests that increased spending on health is associated with higher life expectancy, with health expenditure as a percentage of GDP showing a stronger relationship than total health expenditure.

### Socio-Economic and Educational Indicators

To visualize the impact of the **Socio-Economic and Educational Indicators** on life expectancy,

```{r}
socio_economic_educational_indicators <- dataset %>%
  select(Life.expectancy, Income.composition.of.resources,
         GDP, Schooling, Population)
head(socio_economic_educational_indicators)
```

```{r}
socio_economic_educational_indicators_long_format <-
  socio_economic_educational_indicators %>%
  pivot_longer(cols = -Life.expectancy,
               names_to = "socio_economic_indicators",
               values_to = "values") %>%
  filter(!is.na(Life.expectancy),
         !(socio_economic_indicators == "Income.composition.of.resources"
           & values == 0),
         !(socio_economic_indicators == "GDP"
           & values == 0),
         !(socio_economic_indicators == "Schooling"
           & values == 0),
         !(socio_economic_indicators == "Population"
           & values == 0))
head(socio_economic_educational_indicators_long_format)
```

```{r}
custom_labels_5 <- c(
  "Income.composition.of.resources" = "Human Development Index",
  "GDP" = "GDP per Capita (USD)",
  "Schooling" = "Years of Schooling",
  "Population" = "Population"
)

ggplot(socio_economic_educational_indicators_long_format,
       aes(x = values, y = Life.expectancy)) +
  geom_point(alpha = 0.5, color = "#2e6a57") +
  geom_smooth(method = "lm", se = FALSE, color = "#9b2542") +
  facet_wrap(~ socio_economic_indicators, scales = "free_x",
             labeller = labeller(socio_economic_indicators = custom_labels_5)) +
  labs(title = "Impact of Socio-Economic and Educational Indicators<br>
       on Life Expectancy", x = "", y = "Life Expectancy (Years)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                              lineheight = 1.2),
    axis.title.y = element_text(size = 12)
  ) +
  theme(plot.title = element_markdown())
```

```{r}
socio_economic_educational_ind <- dataset %>%
  select(
    `Life Expectancy` = Life.expectancy,
    `HDI` = Income.composition.of.resources,
    `GDP` = GDP,
    `Years of Schooling` = Schooling,
    `Population` = Population
    )
socio_economic_educational_ind_cor <-
  cor(socio_economic_educational_ind, use = "complete.obs")
socio_economic_educational_ind_cor_long_format <-
  melt(socio_economic_educational_ind_cor)
head(socio_economic_educational_ind_cor_long_format)
```

```{r}
ggplot(socio_economic_educational_ind_cor_long_format,
       aes(Var1, Var2, fill = value)) +
  geom_tile(color = "white", size = 0.5) +
  geom_text(aes(label = round(value, 2)), color = "black", size = 3.5) +
  scale_fill_gradient2(low = "#2b457e", high = "#9b2542", mid = "white",
                       midpoint = 0, limit = c(-1, 1), space = "Lab",
                       name = "Correlation Coefficient") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold",
                              lineheight = 1.2),
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
    axis.title.x = element_blank(),
    axis.title.y = element_blank()) +
  coord_fixed() +
  labs(title = "Correlation Analysis of<br>
       Socio-Economic and Educational Indicators") +
  theme(plot.title = element_markdown())
```

The correlation between **HDI (Human Development Index)** and **Life Expectancy** is **0.76**. This indicates a strong positive relationship, meaning as HDI increases, Life Expectancy also tends to increase.

The correlation between **GDP (Gross Domestic Product)** and **Life Expectancy** is **0.47**. This shows a moderate positive relationship, suggesting that higher GDP is associated with higher Life Expectancy, but the relationship is not as strong as with HDI.

The correlation between **Years of Schooling** and **Life Expectancy** is **0.77**. This indicates a strong positive relationship, similar to HDI, suggesting that more years of schooling are associated with higher Life Expectancy.

The correlation between **Population** and **Life Expectancy** is **-0.02**. This shows a very weak negative relationship, indicating that Population size has almost no linear relationship with Life Expectancy in this dataset.

In summary, HDI and Years of Schooling have strong positive correlations with Life Expectancy, while GDP has a moderate positive correlation. Population size, however, shows almost no correlation with Life Expectancy.

# Hypothesis Testing


## Hypothesis testing and Linear Regression for the relationship between Gross Domestic Product (GDP) and life expectancy.

Null Hypothesis ($H_{0}$): There is no significant relationship between GDP and life expectancy.
Alternative Hypothesis ($H_{1}$): There is a significant relationship between GDP and life expectancy.

First, we will check the missing values in the GDP and life expectancy variables and remove the rows with missing values in The GDP or Life Expectancy columns.

```{r}
data <- dataset
# Remove rows with missing values in GDP or Life expectancy
data <- data %>% 
  filter(!is.na(GDP) & !is.na(Life.expectancy))
```

# Exploratory Data Analysis
```{r}
ggplot(data, aes(x = GDP, y = Life.expectancy)) +
  geom_point() +
  labs(title = "Scatter plot of GDP vs Life Expectancy",
       x = "GDP",
       y = "Life Expectancy")
```
Following Observation can be done from above visualization:

- As GDP increases, life expectancy tends to rise as well. This means that there is a positive correlation between GDP and life expectancy.

- Lower GDP levels (below $25,000) are associated with a dense cluster of countries whose life expectancy varies greatly, mostly between 50 and 80 years.

- For higher GDP levels, the data points are more dispersed but show a consistent increase in life expectancy, approaching 80-90 years.

- A small number of data points, which may be anomalies, show nations with extremely high GDPs (over $100,000) and long life expectancies (above 80 years).

# Correlation Analysis
```{r}
cor_test <- cor.test(data$GDP, data$Life.expectancy)
print(cor_test)
```
The Pearson correlation coefficient between GDP and life expectancy = 0.4615

A slightly positive association has been found between GDP and life expectancy, according to the Pearson correlation. This indicates that life expectancy normally tends to increase along with GDP growth.

The null hypothesis can be rejected as the p-value is less than 2.2e-16.

Although GDP and life expectancy are positively correlated, this link may not be perfect.

# Linear Regression
```{r}
model <- lm(Life.expectancy ~ GDP, data = data)
summary(model)
```
Coefficient for GDP: 0.0003117

This indicates that life expectancy rises by about 0.00031 years on average for every unit increase in GDP. In real terms, life expectancy rises by 0.3117 years, or around 3.7 months, on average, for every $1,000 increase in GDP.

R-squared: 0.2129

The R-squared value indicates that only 21.29% of the variance in life expectancy can be explained by GDP. This implies that while GDP is a useful predictor of life expectancy, a significant amount of the variation in life expectancy can be explained by factors other than the GDP.

The projected life expectancy at zero GDP, which may not be a realistic scenario, is represented by the intercept value of 67.04 and serves as the model default.

The model's overall statistical significance is also supported by the F-statistic of 671.8 with a p-value < 2.2e-16.

# Hypothesis Testing

From our linear regression results:

- The p-value for GDP is < 2e-16. We reject the null hypothesis since the p-value is substantially smaller than the typical level of significance (e.g., 0.05).

- This means there is strong evidence to suggest that GDP is a statistically significant predictor of life expectancy. In the context of the research question, we conclude that there is a significant positive relationship between a country's GDP and its life expectancy. Therefore, GDP does have an impact on life expectancy, though the relationship explains only about 21.29% of the variance, indicating that other factors also contribute to life expectancy outcomes.

# Model Diagnostics

```{r}
par(mfrow = c(2, 2))
plot(model)
```
Observations:

- Linearity: No obvious non-linear trend can be seen in the Residuals vs. Fitted plot. Since the majority of the residuals are randomly distributed around the horizontal line (at 0), it appears that the linearity assumption is mostly satisfied. The residuals do, however, marginally diverge at several points, suggesting that the model may contain some modest non-linearity.

- Normality of residuals: The residuals' distribution with respect to a normal distribution is displayed in the Q-Q Residuals plot. The residuals appear to be roughly normally distributed because the majority of the spots are in close proximity to the theoretical line. 

- Homoscedasticity: The spread of the residuals looks to be somewhat stable throughout the fitted value range in the Scale-Location plot. This implies that there is a good deal of satisfaction with the homoscedasticity assumption (constant variance of residuals). There isn't a distinct funnel-shaped pattern that would suggest variation is rising or falling.

- Influential points: Any potentially significant points are highlighted by the Residuals vs. Leverage graphic. None of the points seem to have excessive leverage or residuals that would be regarded as particularly significant, though a couple of points near the plot's right end might be worth looking into more closely. Even while they might not have a big effect on the model as a whole, it could still be beneficial to look at them more.

# Discussion and Conclusion

Our analysis reveals:

- The correlation and regression analyses reveal a substantial association between GDP and life expectancy, as evidenced by the extremely modest p-value (< 2e-16).

- The correlation coefficient of 0.4615 indicates a moderately strong but favourable nature of the association. This indicates that as GDP increases, life expectancy tends to increase as well, though the relationship is not very strong.

- With an R-squared value of 0.2129, the linear regression model explains 21.29% of the variation in life expectancy. Variations in life expectancy are largely caused by a number of different factors, although GDP is one of them

To sum up, our research indicates that GDP is a positively and statistically significant predictor of life expectancy, but it only partially explains the variance in life expectancy between nations. This shows that other social and environmental factors are just as significant for extending life expectancy as money. Additional studies that take a wider range of variables into account may shed additional light on the factors that influence life expectancy.


# Hypothesis Testing and Linear Regression for Schooling

There is a linear relationship between Years of Schooling and Life Expectancy (for more details, please see the EDA part for your reference).

Null hypothesis (H0) that there is no relationship between schooling and life expectancy.
Alternative hypothesis (H1) More schooling leads to higher life expectancy
```{r}
data1_filtered <- dataset[dataset$Schooling != 0, ]
data1_filtered <- data1_filtered[!(data1_filtered$Schooling == 0 | data1_filtered$Schooling == "" | is.na(data1_filtered$Schooling) | data1_filtered$`Life.expectancy` == 0 | data1_filtered$`Life.expectancy` == "" | is.na(data1_filtered$`Life.expectancy`)), ]


mean_value <- mean(data1_filtered$Schooling)
median_value <- median(data1_filtered$Schooling)
max_value <- max(data1_filtered$Schooling)
min_value <- min(data1_filtered$Schooling)


cat("Mean:", mean_value, "\n")
cat("Median:", median_value, "\n")
cat("Max:", max_value, "\n")
cat("Min:", min_value, "\n")
```


```{r}
model <- lm(`Life.expectancy` ~ Schooling, data = data1_filtered)

model_summary <- summary(model)
model_summary
```
Very low p value, can reject null hypothesis, is a relationship between schooling and life expectancy. Schooling has a statistically significant effect on life expectancy.

41.3 is estimated life expectancy when schooling is 0, life expectancy expected to increased by about 2.32 years for every year of schooling.

R-squared of 0.6139 suggests that 61.39% of the variance in life expectancy is explained by schooling


```{r}
par(mfrow = c(2, 2))
plot(model)
```
The majority of the residuals in the residuals vs fitted plot are around the horizontal line at 0 satisfying linearity. The residuals also in the Q-Q plot follow a straight line satisfying normality. The spread of the residuals in the residuals vs fitted plot is also randomly scattered suggesting that homoscedasticity is satisfied.

```{r}
coef_summary <- summary(model)$coefficients
t_statistic <- coef_summary["Schooling", "Estimate"] / coef_summary["Schooling", "Std. Error"]

df <- model$df.residual

alpha <- 0.05
t_critical <- qt(1 - alpha, df)

cat("T-Statistic:", t_statistic, "\n")
cat("Critical T-Value:", t_critical, "\n")

if (t_statistic > t_critical) {
  cat("Reject the null hypothesis: Schooling is associated with increased life expectancy.\n")
} else {
  cat("Fail to reject the null hypothesis: No significant association.\n")
}


estimate <- model_summary$coefficients["Schooling", "Estimate"]
std_error <- model_summary$coefficients["Schooling", "Std. Error"]

margin_of_error <- t_critical * std_error
lower_bound <- estimate - margin_of_error
upper_bound <- estimate + margin_of_error


cat("95% Confidence Interval for the Schooling coefficient:", lower_bound, "to", upper_bound, "\n")
```
Very strong evidence that for each year of schooling expect life expectancy to increase between 2.26 and 2.38 years.


# Linear Regression

# Multiple Linear Regression
## Prepocessing Data
### 1. Data Cleaning 
We utilize the median value of the country to fill in missing data, except for Hepatitis B and Population, which have a high number of missing entries. If any gaps persist, we will substitute them with the overall median value of the country. The variables Country and Year will be excluded, while Life Expectancy (Y) and other numerical variables (X) will be retained.



```{r}
raw <- dataset

raw <- raw %>%
  mutate(across(4:ncol(raw), ~ as.numeric(.)))


data = raw %>% 
        group_by(Country) %>%  
        mutate(across(4:21, ~ ifelse(is.na(.), median(., na.rm = TRUE), .))) %>%  
        ungroup() %>%
        mutate(across(4:21, ~ ifelse(is.na(.), median(., na.rm = TRUE), .)))
        
# Remove group median = Nan
data = na.omit(data)
# Remove Country, Year, GDP, Population 
data = subset(data, select = -c(Country,Year,Hepatitis.B, GDP, Population) )

print('Remaining Data Shape: ')
print(dim(data))
```

### 2. Categorize varialbes transform
Country's Status : 1= Developed, 0= Developing
```{r}
data$Status <- ifelse(data$Status == "Developed", 1, 0)
```

### 3.Variance Inflation Factor, VIF

The Variance Inflation Factor (VIF) is a widely used metric in multiple linear regression analysis to **assess the degree of Multicollinearity among the predictor variables**.
\
Multicollinearity occurs when two or more independent variables in a regression model are highly correlated, potentially leading to unreliable and unstable estimates of regression coefficients.
Mathematically, for each predictor variable $X_{i}$, $VIF_{i} = \frac{1}{1-R^2_{i}}$ \
A higher VIF indicates a higher level of Multicollinearity
\
\
`Why we use VIF?`
\
* Unstable Coefficient Estimates: High Multicollinearity can lead to large variances in coefficient estimates, making them sensitive to small changes in the model or data.
\
* Reduced Interpret ability: It becomes difficult to ascertain the individual effect of each predictor on the dependent variable.
\
* Inflated Standard Errors: This leads to wider confidence intervals and less reliable hypothesis tests for the coefficients.

`Solution`
Removing Variables with high level of Multicollinearity to keep its interpretable.


```{r}
# install.packages('car')
library(car)
model_test <- lm(Life.expectancy ~ ., data=data)
vif_values <- vif(model_test)
print(vif_values)
# VIF Result Visualization
barplot(vif_values, 
        main = "VIF Values", 
        horiz = FALSE, 
        col = "steelblue", 
        las = 3,
        cex.names = 0.5)

# VIF threshold = 10
abline(h =10)
```
From the VIF result, we decided to remove **infant.deaths (176.57) ** & **under.five.deaths (175.64)** with higher VIF value over threshold 10. 

```{r}
data = subset(data, select = -c(infant.deaths,under.five.deaths) )
```

## Modeling

### Corelation Observation
We use Correlation Metrics to find out nonlinear realtionship between Y and X.
```{r}

par(mfrow = c(3, 5), mar = c(1, 1, 3, 1))
variable_names <- colnames(data)[colnames(data) != "Life.expectancy"]

for (var in variable_names) {
  plot(data[[var]], data$Life.expectancy,
       main = paste(var),
       xlab = var, 
       ylab = "Life.expectancy", 
       col = "steelblue", 
       pch = 19,
       cex = 0.5,
      cex.main = 0.8)
}

```
There are variables that exhibit potential nonlinear correlations with Y, specifically Life Expectancy. To address this, we introduce polynomial features and interaction features involving these variables.


### 1. Multiple Linear Regression
```{r}
model <- lm(Life.expectancy ~., data=data)
summary(model)
              
```

```{r}
hist(residuals(model), breaks = 30, main = "Histogram of Residuals",
     xlab = "Residuals", col = "lightblue")

predictions <- predict(model, newdata = data, interval = "prediction", level = 0.95)

predicted_values <- predictions[, "fit"]
lower_bound <- predictions[, "lwr"]
upper_bound <- predictions[, "upr"]

ggplot(data, aes(x = data$Life.expectancy, y = predicted_values)) +
  geom_point(color = "blue", alpha = 0.6) + 
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  geom_ribbon(aes(ymin = lower_bound, ymax = upper_bound), alpha = 0.2, fill = "gray") +
  labs(x = "Actual Values", y = "Predicted Values", 
       title = "Actual vs Predicted Values with Prediction Intervals") +
  theme_minimal() 
```
This regression analysis evaluates the influence of different factors on the dependent variable, which could be the probable life expectancy or a health-related outcome. The model comprises 14 independent variables and accounts for 82.1% of the variability (R-squared = 0.821). With an adjusted R-squared value of 0.8201, indicating a robust model fit.

However, certain variables such as total expenditure and thinness (1-19 years) exhibit weaker significance. Therefore, a decision has been made to exclude these variables.


### 2.  Multiple Linear Regression - Remove Non-Significant Variables
```{r}
data = subset(data, select = -c(thinness.5.9.years,thinness..1.19.years,Total.expenditure, Alcohol) )
model_2 <- lm(Life.expectancy ~., data=data)
summary(model_2)
  
```

```{r}
predictions <- predict(model_2, newdata = data, interval = "prediction", level = 0.95)

predicted_values <- predictions[, "fit"]
lower_bound <- predictions[, "lwr"]
upper_bound <- predictions[, "upr"]

ggplot(data, aes(x = data$Life.expectancy, y = predicted_values)) +
  geom_point(color = "blue", alpha = 0.6) + 
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  geom_ribbon(aes(ymin = lower_bound, ymax = upper_bound), alpha = 0.2, fill = "gray") +
  labs(x = "Actual Values", y = "Predicted Values", 
       title = "Actual vs Predicted Values with Prediction Intervals") +
  theme_minimal() 
```
Based on the results from the model without non-significant variables, it is evident that there is no distinction between the two. It can be concluded that the remaining variables significantly influence the dependent variable, which is the life expectancy (Y).

### Summary

There are 82% accuracy in following summary.
```{r}
model_coefficients <- coef(model_2)[2:11]
# Standardize
model_coefficients["Income.composition.of.resources"]<-model_coefficients["Income.composition.of.resources"]/100

coeff_df <- data.frame(
  Variable = names(model_coefficients),
  Coefficient = as.numeric(model_coefficients)
)

ggplot(coeff_df, aes(x = reorder(Variable, Coefficient), y = Coefficient)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() + 
  geom_text(aes(label = round(Coefficient, 3)), color   = "black", size = 3,
            hjust = ifelse(coeff_df$Coefficient < 0, 0.15, -0.15)) +
  labs(title = "Regression Coefficients", x = "Variables", y = "Coefficient") +
  theme_minimal()
```
Conclusion Based on the Multivariate Regression Analysis
The multivariate regression analysis conducted with the formula Life.expectancy ~ . reveals several key insights regarding the factors influencing life expectancy. The model has a high multiple R-squared value of 0.8202, indicating that approximately 82% of the variance in life expectancy can be explained by the independent variables included in the model.

**Key Findings from the Model Coefficients**
\
\
Intercept (Estimate: 51.96): This value represents the expected life expectancy when all predictor variables are set to zero. While it may not be directly interpretable, it provides a baseline for the model.
\
+Status (Estimate: 1.190): Countries classified as developed (coded as 1) tend to have a life expectancy that is approximately 1.19 years higher than those classified as developing (coded as 0). This highlights the positive impact of a developed status on life expectancy.
\
\
-Adult Mortality (Estimate: -0.0174): The coefficient for adult mortality is negative, indicating that for every additional death per 1,000 population, life expectancy decreases by approximately 0.0174 years. This emphasizes the detrimental effect of higher adult mortality rates on overall life expectancy.
\
\
-Percentage Expenditure (Estimate: 0.0003136): An increase in health expenditure as a percentage of GDP per capita is associated with a slight increase in life expectancy, suggesting that higher investment in health services may contribute to better health outcomes.
\
\
-Measles (Estimate: -0.00002568): The negative coefficient implies that a higher number of measles cases is associated with lower life expectancy, reinforcing the importance of vaccination and health interventions to reduce infectious diseases.
\
\
-BMI (Estimate: 0.04752): A higher average Body Mass Index is positively correlated with life expectancy, suggesting that better nutritional status may contribute to improved health outcomes.
\
\
- Polio (Estimate: 0.02578): The positive coefficient indicates that increased polio immunization coverage correlates with higher life expectancy, underlining the significance of vaccination programs.
\ 
\
- Diphtheria (Estimate: 0.03257): Similar to polio, higher diphtheria immunization coverage is associated with increased life expectancy, demonstrating the effectiveness of immunization campaigns.
\
\
-HIV/AIDS (Estimate: -0.4970): The substantial negative impact of HIV/AIDS on life expectancy is evident, with every additional death per 1,000 live births due to HIV/AIDS decreasing life expectancy by approximately 0.497 years. This highlights the urgent need for interventions targeting HIV prevention and treatment.
\
\
-Income Composition of Resources (Estimate: 7.485): This variable has the largest positive coefficient, suggesting that improvements in income composition of resources significantly enhance life expectancy. For every unit increase in this index, life expectancy increases by approximately 7.485 years, indicating the critical role of economic factors in health outcomes.
\
\
- Schooling (Estimate: 0.7806): More years of schooling are positively associated with life expectancy. For each additional year of schooling, life expectancy increases by about 0.78 years, emphasizing the importance of education in promoting better health.



## Hypothesis Testing between Developed and Developing Countries

```{r setup1, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(car)
library(ggplot2)
```



## Data Loading and Preparation

```{r data_prep}
# Load the dataset
data <- read.csv("life_expectancy_data_raw.csv")

# Filter out rows with missing values in relevant columns
data_clean <- data %>%
  filter(!is.na(Status) & !is.na(Life.expectancy) & !is.na(GDP))

# Create binary variable for country status
data_clean$is_developed <- ifelse(data_clean$Status == "Developed", 1, 0)
```

## Descriptive Statistics

```{r descriptive}
# Calculate mean and median life expectancy for each group
stats <- data_clean %>%
  group_by(Status) %>%
  summarize(
    mean_life_expectancy = mean(Life.expectancy),
    median_life_expectancy = median(Life.expectancy),
    n = n()
  )

print(stats)
```

## Hypothesis Testing: T-Test

Null Hypothesis (H0): There is no significant difference in life expectancy between developed and developing countries.
Alternative Hypothesis (H1): There is a significant difference in life expectancy between developed and developing countries.

```{r t_test}
t_test_result <- t.test(Life.expectancy ~ Status, data = data_clean)
print(t_test_result)
```

## Correlation Analysis

```{r correlation}
cor_test <- cor.test(data_clean$is_developed, data_clean$Life.expectancy)
print(cor_test)
```

## Linear Regression

```{r regression}
model <- lm(Life.expectancy ~ is_developed, data = data_clean)
summary(model)
```

## Residual Plot

```{r residual_plot}
plot(model, which = 1)
```

## Q-Q Plot

```{r qq_plot}
plot(model, which = 2)
```

## ANOVA

```{r anova}
anova_result <- aov(Life.expectancy ~ Status, data = data_clean)
summary(anova_result)
```

## Visualization

```{r boxplot}
ggplot(data_clean, aes(x = Status, y = Life.expectancy, fill = Status)) +
  geom_boxplot() +
  labs(title = "Life Expectancy: Developed vs. Developing Countries",
       x = "Country Status", y = "Life Expectancy")
```

## Results and Interpretation

1. **Descriptive Statistics**:
   - Developed countries have a mean life expectancy of `r round(stats$mean_life_expectancy[stats$Status == "Developed"], 2)` years and a median of `r round(stats$median_life_expectancy[stats$Status == "Developed"], 2)` years.
   - Developing countries have a mean life expectancy of `r round(stats$mean_life_expectancy[stats$Status == "Developing"], 2)` years and a median of `r round(stats$median_life_expectancy[stats$Status == "Developing"], 2)` years.

2. **T-Test**: 
   The t-test results show a p-value < 0.05, indicating a statistically significant difference in life expectancy between developed and developing countries. The mean difference is approximately `r round(diff(t_test_result$estimate), 2)` years.

3. **Correlation Analysis**:
   There is a significant positive correlation (r = `r round(cor_test$estimate, 3)`, p < 0.05) between a country's development status and life expectancy.

4. **Linear Regression**:
   The regression model confirms a significant relationship between country status and life expectancy. Being a developed country is associated with an increase of approximately `r round(coef(model)[2], 2)` years in life expectancy.

5. **ANOVA**:
   The ANOVA results corroborate the t-test, showing a significant difference between the groups (p < 0.05).

6. **Residual Plot**:
   The residual plot shows a relatively even spread of residuals around the horizontal line, indicating that the linear model's assumptions of homoscedasticity and linearity are reasonably met. However, there's a slight pattern visible, suggesting that other factors might influence life expectancy or that the relationship might not be perfectly linear.

7. **Q-Q Plot**:
   The Q-Q plot shows that the residuals generally follow the diagonal line, indicating that they are approximately normally distributed. There are some deviations at the tails, which could suggest the presence of outliers or slight non-normality in the extreme values. This slight deviation doesn't severely violate the normality assumption but indicates that there might be some complexities in the data not captured by the simple linear model.

## Conclusion

Based on multiple statistical analyses, we reject the null hypothesis. There is strong evidence of a significant difference in life expectancy between developed and developing countries. Developed countries tend to have higher life expectancies, with an average difference of about `r round(diff(t_test_result$estimate), 2)` years.

The correlation and regression analyses confirm a positive relationship between development status and life expectancy. However, the residual and Q-Q plots suggest that while our model captures a significant trend, there are likely other factors influencing life expectancy that are not accounted for in this simple analysis.

The boxplot visualization clearly shows the difference in distributions between the two groups, with developed countries having a higher median and smaller spread in life expectancy compared to developing countries.

In conclusion, while development status is a significant predictor of life expectancy, the relationship is complex. Future analyses could explore additional variables and more sophisticated models to better understand the factors influencing life expectancy across different countries.







